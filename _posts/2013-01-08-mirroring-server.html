---
layout: post
title: Mirroring a Server
date: '2013-01-08T15:58:00.001+05:30'
author: Rajeev Sreedharan
tags:
- Linux
- Ubuntu
- Servers
modified_time: '2013-01-08T15:59:20.125+05:30'
blogger_id: tag:blogger.com,1999:blog-2447788814762842787.post-4961941602157032018
blogger_orig_url: http://myfossblog.blogspot.com/2013/01/mirroring-server.html
---

Mirroring is a hard to digest word for a normal computer user and usually prefers to risk the security of his data rather than have &nbsp;a redundant backup.<br /><br />Lets define a mirror <br /><blockquote>In data storage, disk mirroring is the replication of logical disk volumes onto separate physical hard disks in real time to ensure continuous availability.</blockquote>However ,I just explain how a redundant backup is to be created and not on the fly&nbsp;transfer&nbsp;of control to the mirror in case of failure.<br /><br />So,Here are the&nbsp;things&nbsp;you would need:<br />1)A master server(preferably ubuntu)<br />2)A slave server,configured in the same way as the master<br />3)SSH server installed at the slave server<br />4)SSH client at the master (should be available by default)<br /><br />Before we start,lets define a few things:<br /><br />a)Both the master and slave has the sever username as "<b>server</b>"<br />b)The directory to be backed up is&nbsp;hitherto&nbsp;referred as <b>DIR</b>.For eg, <b>/home/server/www</b><br />c)IP of the master is <b>192.168.0.1</b><br />d)IP of the slave is&nbsp;<b>192.168.0.2</b><br /><br /><b>Step 1:</b><br /><br />Generate an rsa key at the master and slave<br /><blockquote class="tr_bq"><span style="color: #741b47;">ssh-keygen -t rsa -C '&lt;email&gt;'</span></blockquote>Use Default directory<br />Opt for empty passphrase.<br /><br /><b>Step 2:</b><br /><b><br /></b>On the slave,open <span style="color: #741b47;">~/.ssh/id_rsa.pub </span>and copy the contents to the master's <span style="color: #741b47;">~/.ssh/authorized_keys.</span>Create &nbsp;the file,it will be absent by default.<br /><br />On master run the command<br /><blockquote class="tr_bq"><span style="color: #741b47;">ssh server@192.168.0.2</span></blockquote>Reply yes to the question asked and exit using Ctrl+d.<br /><br /><b>Step 3:</b><br /><br />On the master, edit the crontab by using the command&nbsp;<span style="color: #741b47;">crontab -e</span>&nbsp;A crontab is used to a task,ie run a command repeatedly at fixed intervals of time.<br /><br />Add the following command to the crontab.<br /><blockquote class="tr_bq"><span style="color: #741b47;">* * * * * rsync -avz <b>DIR</b> server@192.168.0.2:<b>DIR</b></span></blockquote>The meaning of the command is that <i>run the <b>rsync</b> command every minute everyday</i>. <span style="color: #741b47;">rsync -avz</span> copies a source to a destination including file permissions and ownership,every minute.The first <b>DIR</b>&nbsp;is the directory in the master server while the <b>server@192.168.0.2:DIR</b> refers to the directory in the slave server.<br /><br />If in any case the master server stops,either assign the IP of the master to the slave manually,if possible(it might be impossible if there is a MAC ID authentication) or edit the DNS to redirect the requests to the slave.Or just start using the slave as master by using the slave IP.